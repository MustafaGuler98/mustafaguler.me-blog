---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

const withBase = (p: string) =>
  `${import.meta.env.BASE_URL.replace(/\/+$/, '')}/${String(p).replace(/^\/+/, '')}`;

export async function getStaticPaths() {
  const posts = await getCollection('posts', (p) => p.data.lang === 'tr' && !p.data.draft);
  return posts.map((p: CollectionEntry<'posts'>) => {
    const slug = p.slug.replace(/^tr\//, '');
    return { params: { slug }, props: { post: p } };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();
---
<Base title={post.data.title} lang="tr">
  <h1>{post.data.title}</h1>
  <p><small>{post.data.pubDate.toISOString().slice(0,10)}</small></p>
  <Content />
  {post.data.translationOf && (
    <p>English version: <a href={withBase(`en/${post.data.translationOf}/`)}>EN</a></p>
  )}
</Base>
