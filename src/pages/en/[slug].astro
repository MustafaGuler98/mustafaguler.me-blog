---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// BASE_URL ("/blog/") ile güvenli birleştirme
const withBase = (p: string) =>
  `${import.meta.env.BASE_URL.replace(/\/+$/, '')}/${String(p).replace(/^\/+/, '')}`;

export async function getStaticPaths() {
  const posts = await getCollection('posts', (p) => p.data.lang === 'en' && !p.data.draft);
  return posts.map((p: CollectionEntry<'posts'>) => {
    const slug = p.slug.replace(/^en\//, '');
    return { params: { slug }, props: { post: p } };
  });
}

const { post } = Astro.props;
const { Content } = await post.render(); // render edip bileşeni al
---
<Base title={post.data.title} lang="en">
  <h1>{post.data.title}</h1>
  <p><small>{post.data.pubDate.toISOString().slice(0,10)}</small></p>
  <Content />
  {post.data.translationOf && (
    <p>Türkçe sürüm: <a href={withBase(`tr/${post.data.translationOf}/`)}>TR</a></p>
  )}
</Base>
